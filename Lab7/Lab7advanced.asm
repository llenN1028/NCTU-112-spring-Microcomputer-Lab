ORG 0000H
AJMP START
ORG 0050H

TABLE:
	DB 00000001B ;0
	DB 00000011B ;1
	DB 00000010B ;2
	DB 00000110B ;3
	DB 00000100B ;4
	DB 00001100B ;5
	DB 00001000B ;6
	DB 00001001B ;7

START:
	MOV DPTR, #TABLE
	MOV P0, #00H
ROW1:
	MOV P1, #7FH
	CALL DELAY
	MOV A, P1
	ANL A, #0FH
	MOV R1, #0
	MOV R4, #0
	MOV R3, #0
	CJNE A, #0FH, COL1
ROW2:
	MOV P1, #0BFH
	CALL DELAY
	MOV A, P1
	ANL A, #0FH
	MOV R1, #4
	MOV R4, #0
	MOV R3, #1
	CJNE A, #0FH, COL1
ROW3:
	MOV P1, #0DFH
	CALL DELAY
	MOV A, P1
	ANL A, #0FH
	MOV R1, #0
	MOV R4, #1
	MOV R3, #0
	CJNE A, #0FH, COL1
ROW4:
	MOV P1, #0EFH
	CALL DELAY
	MOV A, P1
	ANL A, #0FH
	MOV R1, #4
	MOV R4, #1
	MOV R3, #1
	CJNE A, #0FH, COL1
	AJMP ROW1
COL1:
	CJNE A, #0EH, COL2
	MOV R0, #1
	JMP OUTPUT1R
COL2:
	CJNE A, #0DH, COL3
	MOV R0, #2
	JMP OUTPUT2R
COL3:
	CJNE A, #0BH, COL4
	MOV R0, #3
	MOV R2, #2
	JMP OUTPUT12R
COL4:
	CJNE A, #07H, ROW1
	CJNE R3, #0, COL4_12PHASE
	MOV R0, #4
	JMP OUTPUT1R
COL4_12PHASE:
	MOV R0, #4
	JMP OUTPUT12R
OUTPUT1R:
	CJNE R4, #0, OUTPUT1L
	MOV A, R0
	ADD A, R1
	MOV R1, A
	MOV A, #10001000B
OUTPUT1R1:
	MOV R5, #64
OUTPUT1R2:
	MOV P0, A
	CALL DELAY
	RL A
	DJNZ R5, OUTPUT1R2
	DJNZ R1, OUTPUT1R1
	LJMP START
OUTPUT1L:
	MOV A, R0
	ADD A, R1
	MOV R1, A
	MOV A, #10001000B
OUTPUT1L1:
	MOV R5, #64
OUTPUT1L2:
	MOV P0, A
	CALL DELAY
	RR A
	DJNZ R5, OUTPUT1L2
	DJNZ R1, OUTPUT1L1
	LJMP START
OUTPUT2R:
	CJNE R4, #0, OUTPUT2L
	MOV A, R0
	ADD A, R1
	MOV R1, A
	MOV A, #11001100B
OUTPUT2R1:
	MOV R5, #64
OUTPUT2R2:
	MOV P0, A
	CALL DELAY
	RL A
	DJNZ R5, OUTPUT2R2
	DJNZ R1, OUTPUT2R1
	LJMP START
OUTPUT2L:
	MOV A, R0
	ADD A, R1
	MOV R1, A
	MOV A, #11001100B
OUTPUT2L1:
	MOV R5, #64
OUTPUT2L2:
	MOV P0, A
	CALL DELAY
	RR A
	DJNZ R5, OUTPUT2L2
	DJNZ R1, OUTPUT2L1
	LJMP START
OUTPUT12R:
	CJNE R4, #0, OUTPUT12L
	MOV A, R0
	ADD A, R1
	MOV R1, A
	MOV R7, A
OUTPUT12R1:
	MOV A, R7
	MOV R1, A
OUTPUT12R2:
	MOV R5, #9
OUTPUT12R3:
	MOV R6, #0
OUTPUT12R4:
	MOV A, R6
	MOVC A, @A+DPTR
	MOV P0, A
	CALL DELAY
	INC R6
	CJNE R6, #7, OUTPUT12R4
	DJNZ R5, OUTPUT12R3
	DJNZ R1, OUTPUT12R2
	DJNZ R2, OUTPUT12R1
	LJMP START
OUTPUT12L:
	MOV A, R0
	ADD A, R1
	MOV R1, A
	MOV R7, A
OUTPUT12L1:
	MOV A, R7
	MOV R1, A
OUTPUT12L2:
	MOV R5, #9
OUTPUT12L3:
	MOV R6, #7
OUTPUT12L4:
	MOV A, R6
	MOVC A, @A+DPTR
	MOV P0, A
	CALL DELAY 
	DEC R6
	CJNE R6, #0,OUTPUT12L4
	DJNZ R5, OUTPUT12L3
	DJNZ R1, OUTPUT12L2
	DJNZ R2, OUTPUT12L1
	LJMP START	
DELAY:
	PUSH 6
	PUSH 7
	MOV R6, #100
DELAY1:
	MOV R7, #200
DELAY2:
	DJNZ R7, DELAY2
	DJNZ R6, DELAY1
	POP 7
	POP 6
	RET
	END