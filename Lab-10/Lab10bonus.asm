ORG 0000H
AJMP INITIAL
ORG 000BH
AJMP INVERT
ORG 0013H
AJMP INTERRUPT
ORG 0050H

TABLE:
	DB 0C0H  ;0
	DB 0F9H  ;1
	DB 0A4H  ;2
	DB 0B0H  ;3
	DB 099H  ;4
	DB 092H  ;5
	DB 082H  ;6
	DB 0F8H  ;7
	DB 080H  ;8
	DB 098H  ;9
	DB 0FFH  ;blank
INITIAL:
	MOV IE, #10000110B ;INT1 enable Timer0 INT enable
	MOV IP, #00000110B ; INT1 priority	  Timer0 INT priority
	MOV TMOD, #11010010B ;gate1 = 1 counter1 gate0 = 0 timer0 Mode 2
	MOV TL0, #250
	MOV TH0, #250
	MOV TL1, #0
	MOV TH1, #0
	MOV TCON, #01010100B ;enable counter1 enable timer0 INT1 falling edge
	SETB P1.0

	MOV R3, #0
	MOV R2, #0
	MOV R1, #0
	MOV R0, #0
	MOV DPTR, #TABLE

OUTPUT:
	MOV P2, #11110111B
	MOV A, R3
	MOVC A, @A+DPTR
	MOV P0, A
	ACALL DELAY

	MOV P2, #11111011B
	MOV A, R2
	MOVC A, @A+DPTR
	MOV P0, A
	ACALL DELAY

	MOV P2, #11111101B
	MOV A, R1
	MOVC A, @A+DPTR
	ANL A, #01111111B
	MOV P0, A
	ACALL DELAY

	MOV P2, #11111110B
	MOV A, R0
	MOVC A, @A+DPTR
	MOV P0, A
	ACALL DELAY

	ACALL DELAY6us
	AJMP OUTPUT
DELAY6us:
	JNB TF0, $
	CLR TF0
	RET
INVERT:
	CPL P1.0
	RETI
INTERRUPT:
	MOV A, TH1
	MOV R0, #0
	MOV R1, #0
	MOV R2, #0
	MOV R3, #0
	CJNE A, #0, OVERFLOW
	AJMP NOTOVERFLOW
OVERFLOW:
	MOV R2, #2
	MOV R1, #5
	MOV R0, #6
NOTOVERFLOW:
	MOV A, TL1
		
	MOV B, #10
	DIV AB
	MOV R4, A
	MOV A, B
	ADD A, R0
	MOV B, #10
	DIV AB
	MOV R0, B
	ADD A, R1
	MOV R1, A
	MOV A, R4

	
	MOV B, #10
	DIV AB
	MOV R4, A
	MOV A, B
	ADD A, R1
	MOV B, #10
	DIV AB
	MOV R1, B
	ADD A, R2
	MOV R2, A
	MOV A, R4

	MOV B, #10
	DIV AB
	MOV R4, A
	MOV A, B
	ADD A, R2
	MOV B, #10
	DIV AB
	MOV R2, B
	ADD A, R3
	MOV R3, A
	MOV A, R4

	MOV TH1, #0
	MOV TL1, #0
	RETI


DELAY:
	PUSH 7
	PUSH 6
	MOV R7, #100
DELAY1:
	MOV R6, #100
DELAY2:
	DJNZ R6, DELAY2
	DJNZ R7, DELAY1
	POP 6
	POP 7
	RET
	END
	