ORG 0000H
AJMP INITIAL
ORG 0050H
;因為serial port還沒上完，所以這周實驗改為用鍵盤來控制輸出音高

INITIAL:
	MOV TMOD, #00000000B 	
	SETB P0.0

ROW1:
	MOV P1, #7FH
	LCALL DELAY
	MOV A, P1
	ANL A, #0FH
	MOV R0, #0
	CJNE A, #0FH, COL1
ROW2:
	MOV P1, #0BFH
	LCALL DELAY
	MOV A, P1
	ANL A, #0FH
	MOV R0, #4
	CJNE A, #0FH, COL1
COL1:
	CJNE A, #0EH, COL2
	MOV R1, #0
	JMP DO
COL2:
	CJNE A, #0DH, COL3
	MOV R1, #1
	JMP DO
COL3:
	CJNE A, #0BH, COL4
	MOV R1, #2
	JMP DO
COL4:
	CJNE A, #07H, ROW1
	MOV R1, #3
	JMP DO

DO:
	MOV A, R0
	ADD A, R1
	
	CJNE A, #0, RE
	
	MOV TL0, #12
	MOV TH0, #196

	MOV R3, #4
	SETB TR0

DELAYDO:
	MOV R2, #131
DELAYDO1:
	ACALL INVERTDO
	DJNZ R2, DELAYDO1
	DJNZ R3, DELAYDO
	CLR TR0
	AJMP ROW1

INVERTDO:
	CPL P0.0
	JNB TF0, $
	CLR TF0
	MOV TL0, #12
	MOV TH0, #196
	RET

RE:

	CJNE A, #1, MI
	
	MOV TL0, #28
	MOV TH0, #202

	MOV R3, #3
	SETB TR0

DELAYRE:
	MOV R2, 196
DELAYRE1:
	ACALL INVERTRE
	DJNZ R2, DELAYRE1
	DJNZ R3, DELAYRE
	CLR TR0
	AJMP ROW1

INVERTRE:
	CPL P0.0
	JNB TF0, $
	CLR TF0
	MOV TL0, #28
	MOV TH0, #202
	RET	

MI:

	CJNE A, #2, FA
	
	MOV TL0, #21
	MOV TH0, #208

	MOV R3, #3
	SETB TR0

DELAYMI:
	MOV R2, #220
DELAYMI1:
	ACALL INVERTMI
	DJNZ R2, DELAYMI1
	DJNZ R3, DELAYMI
	CLR TR0
	AJMP ROW1

INVERTMI:
	CPL P0.0
	JNB TF0, $
	CLR TF0
	MOV TL0, #21
	MOV TH0, #208
	RET	

FA:

	CJNE A, #3, SO
	
	MOV TL0, #8
	MOV TH0, #211

	MOV R3, #3
	SETB TR0

DELAYFA:
	MOV R2, #233
DELAYFA1:
	ACALL INVERTFA
	DJNZ R2, DELAYFA1
	DJNZ R3, DELAYFA
	CLR TR0
	AJMP ROW1

INVERTFA:
	CPL P0.0
	JNB TF0, $
	CLR TF0
	MOV TL0, #8
	MOV TH0, #211
	RET	


SO:

	CJNE A, #4, LA
	
	MOV TL0, #5
	MOV TH0, #216

	MOV R3, #4
	SETB TR0

DELAYSO:
	MOV R2, #196
DELAYSO1:
	ACALL INVERTSO
	DJNZ R2, DELAYSO1
	DJNZ R3, DELAYSO
	CLR TR0
	AJMP ROW1

INVERTSO:
	CPL P0.0
	JNB TF0, $
	CLR TF0
	MOV TL0, #5
	MOV TH0, #216
	RET	


LA:
	
	CJNE A, #5, SI
	
	MOV TL0, #16
	MOV TH0, #220

	MOV R3, #4
	SETB TR0

DELAYLA:
	MOV R2, #220
DELAYLA1:
	ACALL INVERTLA
	DJNZ R2, DELAYLA1
	DJNZ R3, DELAYLA
	CLR TR0
	AJMP ROW1

INVERTLA:
	CPL P0.0
	JNB TF0, $
	CLR TF0
	MOV TL0, #16
	MOV TH0, #220
	RET	

SI:

	CJNE A, #6, RESET 
	
	MOV TL0, #12
	MOV TH0, #224

	MOV R3, #4
	SETB TR0

DELAYSI:
	MOV R2, #247
DELAYSI1:
	ACALL INVERTSI
	DJNZ R2, DELAYSI1
	DJNZ R3, DELAYSI
	CLR TR0
	AJMP ROW1

INVERTSI:
	CPL P0.0
	JNB TF0, $
	CLR TF0
	MOV TL0, #12
	MOV TH0, #224
	RET	
RESET:
	LJMP ROW1


DELAY:
	MOV R5, #100
DELAY1:
	MOV R6, #100
DELAY2:
	DJNZ R6, DELAY2
	DJNZ R5, DELAY1
	RET
	END










